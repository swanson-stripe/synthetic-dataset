<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>React Integration Example - Dashboard Synthetic Data</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            margin: 0;
            padding: 20px;
            background: #f8f9fa;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .code-example {
            background: #f1f5f9;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 14px;
            overflow-x: auto;
        }
        
        .integration-info {
            background: #e0f2fe;
            border: 1px solid #0284c7;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .integration-info h3 {
            margin: 0 0 12px 0;
            color: #0c4a6e;
        }
        
        .integration-info p {
            margin: 0;
            color: #0c4a6e;
        }

        .demo-container {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="integration-info">
            <h3>ðŸš€ React Drop-in Components Demo</h3>
            <p>This example shows how to use the pre-built React components for Dashboard Synthetic Data. Copy the components below and use them in your v0, Next.js, or React projects!</p>
        </div>

        <div class="code-example">
// Option 1: Complete DashboardKit (One Component)
import { DashboardKit } from './dashboard-components'

export default function Dashboard() {
    return (
        &lt;DashboardKit 
            defaultPersona="modaic"
            onPersonaChange={(data, persona, stage) => {
                console.log('Switched to:', persona, stage)
            }}
        /&gt;
    )
}
        </div>

        <div class="code-example">
// Option 2: Individual Components (Custom Layout)
import { 
    useDashboardData, 
    PersonaSelector, 
    MetricCards, 
    PaymentsTable 
} from './dashboard-components'

export default function Dashboard() {
    const { 
        metrics, 
        payments, 
        currentPersona, 
        currentStage,
        switchPersona,
        availablePersonas 
    } = useDashboardData()

    return (
        &lt;div className="space-y-6"&gt;
            &lt;div className="flex justify-between items-center"&gt;
                &lt;h1 className="text-2xl font-bold"&gt;My Dashboard&lt;/h1&gt;
                &lt;PersonaSelector 
                    currentPersona={currentPersona}
                    currentStage={currentStage}
                    availablePersonas={availablePersonas}
                    onPersonaChange={switchPersona}
                    onStageChange={(stage) => switchPersona(currentPersona, stage)}
                /&gt;
            &lt;/div&gt;
            &lt;MetricCards metrics={metrics} /&gt;
            &lt;PaymentsTable payments={payments} /&gt;
        &lt;/div&gt;
    )
}
        </div>

        <div class="demo-container">
            <h2 style="margin-bottom: 20px; color: #1a1a1a;">Live React Demo</h2>
            <div id="react-demo-root"></div>
        </div>

        <!-- Component Source Code Display -->
        <div class="demo-container">
            <h2 style="margin-bottom: 20px; color: #1a1a1a;">Component Source Code</h2>
            <p style="margin-bottom: 20px; color: #666;">Copy these components into your React project:</p>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                <div>
                    <h3 style="color: #374151; margin-bottom: 10px;">useDashboardData Hook</h3>
                    <button onclick="showComponent('useDashboardData')" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                        View Hook Code
                    </button>
                </div>
                
                <div>
                    <h3 style="color: #374151; margin-bottom: 10px;">PersonaSelector Component</h3>
                    <button onclick="showComponent('PersonaSelector')" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                        View Component Code
                    </button>
                </div>
                
                <div>
                    <h3 style="color: #374151; margin-bottom: 10px;">MetricCards Component</h3>
                    <button onclick="showComponent('MetricCards')" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                        View Component Code
                    </button>
                </div>
                
                <div>
                    <h3 style="color: #374151; margin-bottom: 10px;">PaymentsTable Component</h3>
                    <button onclick="showComponent('PaymentsTable')" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                        View Component Code
                    </button>
                </div>
                
                <div>
                    <h3 style="color: #374151; margin-bottom: 10px;">Complete DashboardKit</h3>
                    <button onclick="showComponent('DashboardKit')" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                        View Kit Code
                    </button>
                </div>
            </div>
            
            <div id="component-code" style="margin-top: 20px;"></div>
        </div>

        <div class="integration-info">
            <h3>ðŸ“‹ How to Use in Your Project</h3>
            <p><strong>v0:</strong> Copy the component code and paste it into your v0 project. Use Tailwind classes for styling.<br>
            <strong>Next.js:</strong> Create component files and import them. Works with app router and pages router.<br>
            <strong>Create React App:</strong> Add components to your src/components folder and import.</p>
        </div>
    </div>

    <!-- Load the React component library -->
    <script src="../dashboard-synthetic-data-react.js"></script>

    <!-- React Demo Implementation -->
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Demo implementation of the dashboard hook
        function useDashboardData(options = {}) {
            const [kit, setKit] = useState(null);
            const [metrics, setMetrics] = useState([]);
            const [payments, setPayments] = useState([]);
            const [customers, setCustomers] = useState([]);
            const [currentPersona, setCurrentPersona] = useState('');
            const [currentStage, setCurrentStage] = useState('');
            const [loading, setLoading] = useState(true);
            const [error, setError] = useState(null);

            useEffect(() => {
                let mounted = true;
                
                const loadDataKit = async () => {
                    try {
                        // Check if script already loaded
                        if (!window.DashboardSyntheticData) {
                            const script = document.createElement('script');
                            script.src = 'https://swanson-stripe.github.io/synthetic-dataset/docs/dashboard-synthetic-data.js';
                            
                            await new Promise((resolve, reject) => {
                                script.onload = resolve;
                                script.onerror = reject;
                                document.head.appendChild(script);
                            });
                        }

                        if (!mounted) return;

                        const newKit = new window.DashboardSyntheticData({
                            autoInject: false, // React handles UI
                            defaultPersona: options.defaultPersona || 'modaic',
                            defaultStage: options.defaultStage || 'growth',
                            onPersonaChange: (data, persona, stage) => {
                                if (mounted) {
                                    updateData(newKit);
                                    options.onPersonaChange?.(data, persona, stage);
                                }
                            }
                        });
                        
                        if (mounted) {
                            setKit(newKit);
                            updateData(newKit);
                            setLoading(false);
                        }
                    } catch (err) {
                        if (mounted) {
                            setError('Failed to load dashboard data');
                            setLoading(false);
                        }
                    }
                };

                loadDataKit();
                
                return () => {
                    mounted = false;
                };
            }, []);

            const updateData = (dataKit) => {
                setMetrics(dataKit.getMetrics());
                setPayments(dataKit.getData('payments'));
                setCustomers(dataKit.getData('customers'));
                setCurrentPersona(dataKit.getCurrentPersona());
                setCurrentStage(dataKit.getCurrentStage());
            };

            const switchPersona = (persona, stage) => {
                if (kit) {
                    kit.switchPersona(persona, stage);
                }
            };

            return {
                kit,
                metrics,
                payments,
                customers,
                currentPersona,
                currentStage,
                loading,
                error,
                switchPersona,
                availablePersonas: kit?.getAvailablePersonas() || {},
                getData: (type) => kit?.getData(type) || []
            };
        }

        // PersonaSelector Component
        function PersonaSelector({ 
            currentPersona, 
            currentStage,
            availablePersonas, 
            onPersonaChange, 
            onStageChange,
            className = '' 
        }) {
            const [isOpen, setIsOpen] = useState(false);
            const [showModal, setShowModal] = useState(false);
            const dropdownRef = useRef(null);
            
            const currentPersonaData = availablePersonas[currentPersona];
            const stages = ['early', 'growth', 'mature'];
            
            useEffect(() => {
                function handleClickOutside(event) {
                    if (dropdownRef.current && !dropdownRef.current.contains(event.target)) {
                        setIsOpen(false);
                    }
                }
                
                document.addEventListener('mousedown', handleClickOutside);
                return () => document.removeEventListener('mousedown', handleClickOutside);
            }, []);
            
            if (!currentPersonaData) return null;

            const getPersonaLogo = (personaId) => 
                `https://swanson-stripe.github.io/synthetic-dataset/docs/assets/${personaId}.png`;

            return (
                <>
                    <div className={`relative ${className}`} ref={dropdownRef}>
                        {/* Main Selector Button */}
                        <button
                            onClick={() => setIsOpen(!isOpen)}
                            className="flex items-center gap-3 bg-white border border-gray-200 rounded-xl px-4 py-3 hover:bg-gray-50 transition-all duration-200 shadow-sm min-w-[240px]"
                        >
                            <img 
                                src={getPersonaLogo(currentPersona)}
                                alt={currentPersonaData.name}
                                className="w-8 h-8 rounded-lg object-cover"
                                onError={(e) => {
                                    e.target.style.display = 'none';
                                }}
                            />
                            <div className="flex-1 text-left">
                                <div className="font-medium text-gray-900">{currentPersonaData.name}</div>
                            </div>
                            <svg 
                                className={`w-3 h-3 text-gray-400 transition-transform duration-200 ${isOpen ? 'rotate-180' : ''}`}
                                fill="currentColor" 
                                viewBox="0 0 20 20"
                            >
                                <path fillRule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clipRule="evenodd" />
                            </svg>
                        </button>

                        {/* Dropdown Popover */}
                        {isOpen && (
                            <div className="absolute top-full left-0 right-0 mt-2 bg-white border border-gray-200 rounded-2xl shadow-xl z-50 overflow-hidden">
                                {/* Current Persona Info */}
                                <div className="p-6 text-center border-b border-gray-100">
                                    <img 
                                        src={getPersonaLogo(currentPersona)}
                                        alt={currentPersonaData.name}
                                        className="w-12 h-12 rounded-lg object-cover mx-auto mb-3"
                                        onError={(e) => {
                                            e.target.style.display = 'none';
                                        }}
                                    />
                                    <h3 className="font-semibold text-lg text-gray-900 mb-2">{currentPersonaData.name}</h3>
                                    <p className="text-sm text-gray-500 mb-4">{currentPersonaData.description}</p>
                                    
                                    {/* Stage Selection */}
                                    <div className="space-y-2">
                                        <p className="text-sm font-medium text-gray-600">Business stage</p>
                                        <div className="space-y-1">
                                            {stages.map((stage) => (
                                                <button
                                                    key={stage}
                                                    onClick={() => {
                                                        onStageChange(stage);
                                                        setIsOpen(false);
                                                    }}
                                                    className={`w-full flex items-center justify-between px-2 py-2 rounded-lg transition-colors ${
                                                        stage === currentStage 
                                                            ? 'bg-gray-100' 
                                                            : 'hover:bg-gray-50'
                                                    }`}
                                                >
                                                    <span className="text-sm capitalize">{stage}</span>
                                                    {stage === currentStage && (
                                                        <div className="w-5 h-5 bg-gray-600 rounded-full flex items-center justify-center">
                                                            <svg className="w-3 h-3 text-white" fill="currentColor" viewBox="0 0 20 20">
                                                                <path fillRule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clipRule="evenodd" />
                                                            </svg>
                                                        </div>
                                                    )}
                                                </button>
                                            ))}
                                        </div>
                                        
                                        <button
                                            onClick={() => {
                                                setShowModal(true);
                                                setIsOpen(false);
                                            }}
                                            className="text-sm text-gray-700 hover:text-gray-900 underline mt-4"
                                        >
                                            Change business
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>

                    {/* Modal for Persona Selection */}
                    {showModal && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                            <div className="bg-white rounded-2xl max-w-4xl w-full max-h-[80vh] overflow-hidden flex">
                                {/* Left Panel - Persona List */}
                                <div className="w-1/2 p-6 border-r border-gray-200 flex flex-col">
                                    <div className="mb-6">
                                        <h2 className="text-xl font-semibold text-gray-900 mb-2">Choose a business</h2>
                                        <p className="text-gray-600">Select a business model to explore different payment scenarios.</p>
                                    </div>
                                    
                                    <div className="flex-1 overflow-y-auto space-y-2">
                                        {Object.values(availablePersonas).map((persona) => (
                                            <button
                                                key={persona.id}
                                                onClick={() => onPersonaChange(persona.id)}
                                                className={`w-full flex items-center gap-3 p-3 rounded-lg border-2 transition-all ${
                                                    persona.id === currentPersona
                                                        ? 'border-purple-500 bg-purple-50'
                                                        : 'border-transparent hover:bg-gray-50'
                                                }`}
                                            >
                                                <img 
                                                    src={getPersonaLogo(persona.id)}
                                                    alt={persona.name}
                                                    className="w-10 h-10 rounded-lg object-cover"
                                                    onError={(e) => {
                                                        e.target.style.display = 'none';
                                                    }}
                                                />
                                                <div className="text-left">
                                                    <div className="font-medium text-gray-900">{persona.name}</div>
                                                    <div className="text-sm text-gray-500">{persona.business_model?.replace(/_/g, ' ')}</div>
                                                </div>
                                            </button>
                                        ))}
                                    </div>
                                    
                                    <button
                                        onClick={() => setShowModal(false)}
                                        className="w-full mt-6 px-4 py-3 bg-white border border-gray-300 rounded-lg font-medium text-gray-700 hover:bg-gray-50 transition-colors"
                                    >
                                        Done
                                    </button>
                                </div>

                                {/* Right Panel - Persona Details */}
                                <div className="w-1/2 p-6 overflow-y-auto">
                                    <h3 className="text-xl font-semibold text-gray-900 mb-4">{currentPersonaData.name}</h3>
                                    <p className="text-gray-600 mb-6 leading-relaxed">{currentPersonaData.description}</p>
                                    
                                    <div>
                                        <h4 className="font-medium text-gray-900 mb-3">Products used</h4>
                                        <ul className="space-y-2">
                                            {currentPersonaData.products?.map((product, index) => (
                                                <li key={index} className="text-gray-600 flex items-center gap-2">
                                                    <div className="w-1.5 h-1.5 bg-gray-400 rounded-full"></div>
                                                    {product}
                                                </li>
                                            ))}
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                </>
            );
        }

        // MetricCards Component
        function MetricCards({ metrics, className = '' }) {
            if (!metrics.length) {
                return (
                    <div className={`grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 ${className}`}>
                        {[1, 2, 3, 4].map((i) => (
                            <div key={i} className="bg-white p-6 rounded-xl border border-gray-200 animate-pulse">
                                <div className="h-4 bg-gray-200 rounded mb-3"></div>
                                <div className="h-8 bg-gray-200 rounded"></div>
                            </div>
                        ))}
                    </div>
                );
            }

            return (
                <div className={`grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 ${className}`}>
                    {metrics.map((metric, index) => (
                        <div key={metric.label} className="bg-white p-6 rounded-xl border border-gray-200 hover:shadow-lg transition-shadow duration-200">
                            <div className="text-sm font-medium text-gray-500 mb-2">{metric.label}</div>
                            <div className="text-2xl font-bold text-gray-900">{metric.value}</div>
                        </div>
                    ))}
                </div>
            );
        }

        // PaymentsTable Component
        function PaymentsTable({ payments, className = '' }) {
            const formatCurrency = (cents) => {
                return new Intl.NumberFormat('en-US', {
                    style: 'currency',
                    currency: 'USD'
                }).format(cents / 100);
            };

            const formatDate = (timestamp) => {
                return new Date(timestamp * 1000).toLocaleDateString();
            };

            const getStatusColor = (status) => {
                switch (status) {
                    case 'succeeded': return 'bg-green-100 text-green-800';
                    case 'pending': return 'bg-yellow-100 text-yellow-800';
                    case 'failed': return 'bg-red-100 text-red-800';
                    default: return 'bg-gray-100 text-gray-800';
                }
            };

            if (!payments.length) {
                return (
                    <div className={`bg-white rounded-xl border border-gray-200 ${className}`}>
                        <div className="px-6 py-4 border-b border-gray-200">
                            <h2 className="text-lg font-medium text-gray-900">Recent Payments</h2>
                        </div>
                        <div className="p-6">
                            <div className="animate-pulse space-y-4">
                                {[1, 2, 3, 4, 5].map((i) => (
                                    <div key={i} className="flex space-x-4">
                                        <div className="h-4 bg-gray-200 rounded flex-1"></div>
                                        <div className="h-4 bg-gray-200 rounded w-20"></div>
                                        <div className="h-4 bg-gray-200 rounded w-16"></div>
                                        <div className="h-4 bg-gray-200 rounded w-24"></div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>
                );
            }

            return (
                <div className={`bg-white rounded-xl border border-gray-200 overflow-hidden ${className}`}>
                    <div className="px-6 py-4 border-b border-gray-200">
                        <h2 className="text-lg font-medium text-gray-900">Recent Payments</h2>
                    </div>
                    <div className="overflow-x-auto">
                        <table className="min-w-full divide-y divide-gray-200">
                            <thead className="bg-gray-50">
                                <tr>
                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ID</th>
                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Amount</th>
                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                                </tr>
                            </thead>
                            <tbody className="bg-white divide-y divide-gray-200">
                                {payments.slice(0, 10).map((payment) => (
                                    <tr key={payment.id} className="hover:bg-gray-50">
                                        <td className="px-6 py-4 whitespace-nowrap text-sm font-mono text-gray-900">{payment.id}</td>
                                        <td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                                            {formatCurrency(payment.amount)}
                                        </td>
                                        <td className="px-6 py-4 whitespace-nowrap">
                                            <span className={`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${getStatusColor(payment.status)}`}>
                                                {payment.status}
                                            </span>
                                        </td>
                                        <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                            {formatDate(payment.created)}
                                        </td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>
                </div>
            );
        }

        // Complete Dashboard Component
        function DashboardKit({ 
            defaultPersona, 
            defaultStage, 
            onPersonaChange, 
            className = '' 
        }) {
            const { 
                metrics, 
                payments, 
                currentPersona, 
                currentStage,
                loading, 
                error, 
                switchPersona,
                availablePersonas,
                kit
            } = useDashboardData({ defaultPersona, defaultStage, onPersonaChange });

            if (error) {
                return (
                    <div className="bg-red-50 border border-red-200 rounded-lg p-4">
                        <div className="text-red-800 font-medium">Error loading dashboard data</div>
                        <div className="text-red-600 text-sm mt-1">{error}</div>
                    </div>
                );
            }

            if (loading) {
                return (
                    <div className={`space-y-6 ${className}`}>
                        <div className="flex justify-between items-center">
                            <div className="h-8 bg-gray-200 rounded w-48 animate-pulse"></div>
                            <div className="h-12 bg-gray-200 rounded w-60 animate-pulse"></div>
                        </div>
                        <MetricCards metrics={[]} />
                        <PaymentsTable payments={[]} />
                    </div>
                );
            }

            const handleStageChange = (stage) => {
                if (kit) {
                    kit.switchPersona(currentPersona, stage);
                }
            };

            return (
                <div className={`space-y-6 ${className}`}>
                    {/* Header */}
                    <div className="flex justify-between items-center">
                        <h1 className="text-2xl font-bold text-gray-900">Business Dashboard</h1>
                        <PersonaSelector
                            currentPersona={currentPersona}
                            currentStage={currentStage}
                            availablePersonas={availablePersonas}
                            onPersonaChange={switchPersona}
                            onStageChange={handleStageChange}
                        />
                    </div>

                    {/* Metrics */}
                    <MetricCards metrics={metrics} />

                    {/* Payments Table */}
                    <PaymentsTable payments={payments} />
                </div>
            );
        }

        // Render the demo
        function App() {
            return (
                <DashboardKit 
                    defaultPersona="modaic"
                    onPersonaChange={(data, persona, stage) => {
                        console.log('Switched to:', persona, stage);
                    }}
                />
            );
        }

        ReactDOM.render(<App />, document.getElementById('react-demo-root'));
    </script>

    <script>
        // Function to show component source code
        function showComponent(componentName) {
            const componentCode = window.DashboardSyntheticDataReact?.components[componentName];
            const codeContainer = document.getElementById('component-code');
            
            if (componentCode) {
                codeContainer.innerHTML = `
                    <div class="code-example">
                        <h4 style="margin-bottom: 15px; color: #374151;">${componentName}</h4>
                        <pre style="white-space: pre-wrap; margin: 0;">${componentCode}</pre>
                    </div>
                `;
            } else {
                codeContainer.innerHTML = `
                    <div class="bg-red-50 border border-red-200 rounded-lg p-4">
                        <div class="text-red-800">Component "${componentName}" not found</div>
                    </div>
                `;
            }
        }

        // Make showComponent globally available
        window.showComponent = showComponent;
        
        // Console testing
        console.log('ðŸŽ¯ React Dashboard loaded! Try these commands:');
        console.log('  showComponent("useDashboardData")  // View hook source code');
        console.log('  showComponent("PersonaSelector")   // View selector component');
        console.log('  showComponent("DashboardKit")      // View complete dashboard');
    </script>
</body>
</html>
